(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-618bbcb0"],{"0f7b":function(e,t,a){},"312c":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"container"},[a("div",{staticClass:"topNav"},[a("el-breadcrumb",{staticClass:"breadNav",attrs:{separator:"/"}},[a("el-breadcrumb-item",{staticClass:"crumb1"},[e._v("首页")]),a("el-breadcrumb-item",{staticClass:"crumb1"},[e._v("系统设置")]),a("el-breadcrumb-item",{staticClass:"crumb2"},[e._v("License授权")])],1)],1),a("div",{staticClass:"wrap"},[a("div",{staticClass:"search"},[a("el-form",{ref:"formInline",staticClass:"formInline",attrs:{inline:!0,"label-position":"right","label-width":"145px",model:e.formInline,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"终端名称/网络地址：",prop:"terminalName"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入终端名称/网络地址",oninput:"value=value.replace(/[%]/g, '')"},model:{value:e.formInline.terminalName,callback:function(t){e.$set(e.formInline,"terminalName",t)},expression:"formInline.terminalName"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.advancedSearch,expression:"advancedSearch==true"}],attrs:{label:"日期：",prop:"startDate"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",editable:!1,type:"date",placeholder:"选择开始时间"},model:{value:e.formInline.startDate,callback:function(t){e.$set(e.formInline,"startDate",t)},expression:"formInline.startDate"}}),e._v(" "),a("span",{},[e._v("至")]),e._v(" "),a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",editable:!1,type:"date",placeholder:"选择结束时间"},model:{value:e.formInline.endDate,callback:function(t){e.$set(e.formInline,"endDate",t)},expression:"formInline.endDate"}})],1),a("el-form-item",{staticClass:"advancedBtn"},[a("el-button",{staticClass:"resetBtn",attrs:{size:"small"},on:{click:e.resetForm}},[e._v("重置")]),a("el-button",{staticClass:"searchBtn",attrs:{size:"small"},on:{click:e.searchData}},[e._v("查询")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.advancedFlag,expression:"advancedFlag==true"}],staticClass:"gaoji",attrs:{size:"small"},on:{click:e.switchBtn}},[e._v("展开"),a("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{"font-weight":"bold"}})]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.advancedFlag,expression:"advancedFlag==false"}],staticClass:"gaoji",attrs:{size:"small"},on:{click:e.switchBtn}},[e._v("收起"),a("i",{staticClass:"el-icon-arrow-up el-icon--right",staticStyle:{"font-weight":"bold"}})])],1)],1)],1),a("div",{staticClass:"mainContainer"},[a("div",{staticClass:"tableTitle"},[e._v("授权列表")]),a("div",{staticClass:"popBtn"},[a("el-button",{staticClass:"operateBtn",attrs:{size:"small"},on:{click:e.importLicense}},[e._v("导入")]),a("el-button",{staticClass:"operateBtn",attrs:{size:"small"},on:{click:e.addLicense}},[e._v("新建")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"licenseTable",staticStyle:{width:"99.9%","font-size":"14px"},attrs:{data:e.licenseData,size:"mini","tooltip-effect":"light","element-loading-text":"加载中，请稍后","header-cell-style":{height:"48px","background-color":"#F0F2F5",color:"rgba(0, 0, 0, 0.72)",padding:"0px"},"cell-style":{color:"rgba(0, 0, 0, 0.9)"},fit:!0},on:{"sort-change":e.sortChange}},[a("template",{slot:"empty"},[a("div",[e._v("暂无数据")])]),a("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号",width:"50px"}}),a("el-table-column",{attrs:{prop:"node_name",label:"终端名称","min-width":"100%","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"node_ip",label:"网络地址","min-width":"100%"}}),a("el-table-column",{attrs:{prop:"license_name",label:"授权名称","min-width":"170%"}}),a("el-table-column",{attrs:{prop:"license_type",label:"授权类型","min-width":"100%"},scopedSlots:e._u([{key:"default",fn:function(t){return["2"==t.row.license_type?a("span",[e._v("基础版")]):"3"==t.row.license_type?a("span",[e._v("扩展版")]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"license_create_time",label:"创建时间","min-width":"110%",sortable:"custom","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"license_req_time",label:"上报时间","min-width":"110%"}}),a("el-table-column",{attrs:{prop:"license_authorize_name",label:"授权文件名称","min-width":"110%"}}),a("el-table-column",{attrs:{prop:"license_authorize_time",label:"授权导入时间","min-width":"115%"}}),a("el-table-column",{attrs:{prop:"effect_time",label:"生效时间","min-width":"115%"}}),a("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"100%"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.status?a("span",[e._v("创建和下发请求")]):"1"==t.row.status?a("span",[e._v("获取license请求")]):"2"==t.row.status?a("span",[e._v("导出license请求")]):"3"==t.row.status?a("span",[e._v("授权策略下发")]):"4"==t.row.status?a("span",[e._v("已授权")]):"5"==t.row.status?a("span",[e._v("授权失败")]):"6"==t.row.status?a("span",[e._v("获取license请求验签失败")]):a("span",{staticClass:"grey"},[e._v("初始化状态")])]}}])}),a("el-table-column",{attrs:{prop:"valid_days",label:"有效期（天）","min-width":"100%"}}),a("el-table-column",{attrs:{width:"100px",label:"操作",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.status||"2"==t.row.status?a("el-button",{staticStyle:{color:"#1ac492"},attrs:{type:"text"},on:{click:function(a){return e.exportData(t.row)}}},[e._v("导出")]):a("el-button",{attrs:{disabled:"",type:"text"}},[e._v("导出")]),"4"!=t.row.status?a("el-button",{staticStyle:{color:"#FF4D4F"},attrs:{type:"text"},on:{click:function(a){return e.delData(t.row)}}},[e._v("删除")]):a("el-button",{attrs:{disabled:"",type:"text"}},[e._v("删除")])]}}])})],2),e.pageShow?a("el-pagination",{staticClass:"paging",attrs:{align:"right","current-page":e.currentPage.sync,"page-sizes":[10,20],"page-size":e.pageSize,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)])]),a("import-license",{ref:"importLicense",on:{deliveData:e.addSuccess}}),a("add-license",{ref:"addLicense",on:{newsuccess:e.addSuccess}})],1)},i=[],s=(a("d81d"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("b775")),n=a("ac95"),r=a("b893"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"导入LICENSE文件",width:"30%",visible:e.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t},closed:e.diaclose}},[a("el-form",{ref:"ruleForm",attrs:{"label-position":e.labelPosition,"label-width":"125px",rules:e.rules,model:e.ruleForm,size:"small"}},[a("el-form-item",{attrs:{label:"LICENSE文件：",prop:"file"}},[a("el-input",{staticClass:"fileLabel",staticStyle:{float:"left"},attrs:{type:"text",placeholder:"请选择.license文件",disabled:!0},model:{value:e.ruleForm.file,callback:function(t){e.$set(e.ruleForm,"file",t)},expression:"ruleForm.file"}}),a("el-upload",{ref:"upload",attrs:{"http-request":e.uploadFile,"before-upload":e.beforeUpload,"show-file-list":!1,name:"file",accept:".license",action:e.url,"file-list":e.fileList,"on-change":e.changefile,"auto-upload":!1,"on-success":e.successUpload,"on-error":e.errorUpload,"on-progress":e.progressUpload}},[a("el-button",{staticClass:"llbdwj"},[e._v("浏览本地文件")])],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"canBtn",attrs:{size:"small"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e.btnf1?a("el-button",{staticClass:"sureBtn",attrs:{size:"small"},on:{click:function(t){return e.getdaytime("ruleForm")}}},[e._v("确定")]):e._e()],1)],1)},c=[],d=(a("a434"),a("b0c0"),{name:"ImportLicense",data:function(){return{btnf1:!0,url:"",dialogFormVisible:!1,ruleForm:{file:""},rules:{file:[{required:!0,message:"请选择.license格式文件",trigger:"change"}]},labelPosition:"right",fileList:[],loadingInstance:"",uploadmessage:""}},methods:{uploadFile:function(e){var t=this,a=new FormData;a.append("file",e.file),Object(s["a"])({url:t.url,method:"post",data:a}).then((function(e){var a=e.data;0===a.status?(t.loadingInstance.close(),t.uploadmessage="",t.$message({message:"导入成功!",type:"success",showClose:!0}),t.$refs.upload.clearFiles(),t.dialogFormVisible=!1,t.$emit("deliveData")):(t.loadingInstance.close(),t.btnf1=!0,t.uploadmessage=a.errormessage)}))},beforeUpload:function(e,t){},uploaddialog:function(){var e=this;e.dialogFormVisible=!0},errorUpload:function(e,t,a){},successUpload:function(e,t,a){var l=this;l.$notify.success({title:"成功",message:"文件上传成功"})},progressUpload:function(e,t,a){},changefile:function(e,t){var a=this;a.uploadmessage="",a.fileList.splice(0,a.fileList.length),a.ruleForm.file=e.name,a.fileList.push(t[t.length-1])},getdaytime:function(e){var t=this;t.btnf1=!1,t.$refs[e].validate((function(e){if(!e)return t.btnf1=!0,!1;""===t.uploadmessage?(t.loadingInstance=t.$loading({body:!0,lock:!0,text:"正在上传,请耐心等待,不要刷新页面!"}),t.$refs.upload.submit(),t.$refs.upload.clearFiles()):t.btnf1=!0}))},resetForm:function(e){var t=this;t.$refs[e].resetFields(),t.$refs.upload.clearFiles()},diaOpen:function(){var e=this;e.dialogFormVisible=!0,e.btnf1=!0,e.ruleForm.file="",e.url="/sys/importLTpcmAuthorize",e.$nextTick((function(){e.$refs.upload.clearFiles(),e.$refs["ruleForm"].resetFields()}))},diaclose:function(){var e=this;e.dialogFormVisible=!1,e.$refs.upload.clearFiles()}}}),u=d,m=(a("f65e"),a("2877")),p=Object(m["a"])(u,o,c,!1,null,"7505c17b",null),h=p.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"新建",top:"10vh",width:"30%",visible:e.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t},closed:e.diaclose}},[a("el-form",{ref:"ruleForm",attrs:{"label-position":e.labelPosition,"label-width":"100px",rules:e.rules,model:e.ruleForm,size:"small"}},[a("div",{staticClass:"itemw"},[a("el-form-item",{staticClass:"zdclass",attrs:{prop:"zdname",label:"终端信息："}},[a("div",{staticClass:"searchinputdiv"},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"搜索IP",clearable:""},model:{value:e.searchTableData,callback:function(t){e.searchTableData=t},expression:"searchTableData"}})],1),a("el-table",{ref:"terminalTable",staticClass:"tableStyle",attrs:{"row-key":"nodeId",size:"small",height:e.height,"header-cell-style":{"background-color":"#F0F2F5",padding:"0px"},"cell-style":{color:"rgba(0, 0, 0, 0.9)"},data:e.tableData2.filter((function(t){return!e.searchTableData||t.ip.includes(e.searchTableData)}))},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{"reserve-selection":"",type:"selection",width:"50",align:"center"}}),a("el-table-column",{attrs:{type:"index",label:"序号",width:"50px"}}),a("el-table-column",{attrs:{prop:"name",label:"终端名称","show-overflow-tooltip":!0,"min-width":"100%"}}),a("el-table-column",{attrs:{prop:"ip",label:"网络地址","min-width":"60%"}})],1)],1),a("el-form-item",{staticClass:"formItem",attrs:{prop:"license_type",label:"类型："}},[a("el-radio-group",{on:{change:e.handleLicenseType},model:{value:e.ruleForm.license_type,callback:function(t){e.$set(e.ruleForm,"license_type",t)},expression:"ruleForm.license_type"}},[a("el-radio",{attrs:{label:"2"}},[e._v("基础版")]),a("el-radio",{attrs:{label:"3"}},[e._v("扩展版")])],1)],1),a("el-form-item",{staticClass:"formItem",attrs:{prop:"valid_days",label:"有效期："}},[a("el-input",{staticStyle:{width:"70%"},attrs:{clearable:"",placeholder:"请输入30-3650之间的数字",name:"valid_days",type:"number"},on:{change:e.handleValidDays},model:{value:e.ruleForm.valid_days,callback:function(t){e.$set(e.ruleForm,"valid_days",e._n(t))},expression:"ruleForm.valid_days"}}),e._v(" "),a("span",[e._v("天")])],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"canBtn",attrs:{size:"small"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{staticClass:"sureBtn",attrs:{size:"small",disabled:e.btnf1},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")])],1)],1)},b=[],g={name:"AddLicense",data:function(){var e=function(e,t,a){var l=/^[0-9]+$/;""===t?a(new Error("请输入30-3650之间的整数")):l.test(t)?parseInt(t)<30?a(new Error("请输入大于30的正整数")):parseInt(t)>3650?a(new Error("请输入小于3650的正整数")):a():a(new Error("请输入正整数"))};return{height:0,btnf1:!1,searchTableData:"",tableData2:[],dialogFormVisible:!1,labelPosition:"right",search:"",filterText:"",rules:{zdname:[{required:!0,message:"请选择终端",trigger:"change"}],license_type:[{required:!0,message:"请选择类型",trigger:"change"}],valid_days:[{required:!0,validator:e,trigger:"blur"}]},ruleForm:{zdname:"",license_type:"",valid_days:""},titles2:[{prop:"name",label:"终端名称"},{prop:"ip",label:"网络地址"}],defaultProps:{children:"children",label:"label"},terminalSelection:[],nodeId:[]}},methods:{submitForm:function(e){var t=this;0===t.terminalSelection.length?t.ruleForm.zdname="":t.ruleForm.zdname="1",t.$refs[e].validate((function(e){if(e){for(var a in t.terminalSelection)t.nodeId.push(t.terminalSelection[a].nodeId);var l={license_type:t.ruleForm.license_type,node_ids:t.nodeId,valid_days:t.ruleForm.valid_days};Object(s["a"])({url:"/sys/createLTpcmAuthorize",method:"post",data:JSON.stringify(l)}).then((function(e){var a=e.data;0===a.status?(t.dialogFormVisible=!1,t.$message({message:"操作成功!",type:"success",showClose:!0}),t.$emit("newsuccess")):t.btnf1=!0}))}else t.btnf1=!1}))},handleSelectionChange:function(e){e&&(this.terminalSelection=e,this.ruleForm.zdname="1",this.btnf1=!1)},handleLicenseType:function(e){e&&(this.btnf1=!1)},handleValidDays:function(e){e&&(this.btnf1=!1)},diaOpen:function(){var e=this;this.dialogFormVisible=!0,this.btnf1=!1,this.searchTableData="",this.ruleForm.license_type="",this.ruleForm.valid_days="",this.nodeId=[],this.terminalSelection=[],Object(s["a"])({url:"/LNodeList",method:"post",data:{orderBy:"installer_time desc",online_status:1,searchPage:1,searchSize:1e4}}).then((function(t){var a=t.data;e.tableData2=a.list,a.total>5?e.height=350:0===a.total?e.height=110:e.height=100+42*a.total})),e.$nextTick((function(){e.$refs.ruleForm.clearValidate(),e.$refs.terminalTable.clearSelection()}))},diaclose:function(){this.dialogFormVisible=!1,this.terminalSelection=[],this.nodeId=[]}}},v=g,_=(a("7875"),Object(m["a"])(v,f,b,!1,null,"93be56aa",null)),y=_.exports,w={name:"LicenseAuthorize",components:{ImportLicense:h,AddLicense:y},data:function(){return{loading:!1,formInline:{terminalName:"",startDate:"",endDate:""},advancedSearch:!0,advancedFlag:!1,emptytxt:"",licenseData:[],currentPage:1,total:0,pageSize:10,pageShow:!0,orderBy:"license_create_time desc",autorefresh:""}},created:function(){Object(r["b"])(this.searchData)},mounted:function(){this.loadData()},beforeDestroy:function(){document.onkeydown=null},methods:{loadData:function(){var e=this;this.loading=!0,Object(s["a"])({url:"/sys/lTpcmAuthorizeList",method:"post",data:{condition:this.formInline.terminalName,firstTime:this.formInline.startDate,lastTime:this.formInline.endDate,orderBy:this.orderBy,searchPage:this.currentPage,searchSize:this.pageSize}}).then((function(t){var a=t.data;e.loading=!1,a.list&&(a.list.map((function(e,t){e.license_create_time=Object(n["a"])(e.license_create_time),e.license_req_time=Object(n["a"])(e.license_req_time),e.license_authorize_time=Object(n["a"])(e.license_authorize_time),e.effect_time=Object(n["a"])(e.effect_time)})),e.licenseData=a.list),e.total=a.total,0==a.total?e.emptytxt=!0:e.emptytxt=!1}))},switchBtn:function(){this.advancedSearch=!this.advancedSearch,this.advancedFlag=!this.advancedFlag},indexMethod:function(e){return 1===this.currentPage?e<9?"0"+(e+1):e+1:e+1+this.pageSize*(this.currentPage-1)},sortChange:function(e,t,a){"ascending"==e.order?this.orderBy=e.prop:this.orderBy=e.prop+" desc",this.loadData()},searchData:function(){var e=this;this.currentPage=1,this.loadData(),this.pageShow=!1,this.$nextTick((function(){e.pageShow=!0}))},handleSizeChange:function(e){var t=this;this.currentPage=1,this.pageSize=e,this.pageShow=!1,this.$nextTick((function(){t.pageShow=!0})),this.loadData()},handleCurrentChange:function(e){this.currentPage=e,this.loadData()},importLicense:function(){this.$refs.importLicense.diaOpen()},addLicense:function(){this.$refs.addLicense.diaOpen()},addSuccess:function(){var e=this,t=0;e.autorefresh=setInterval((function(){t++,e.loadData(),t>4&&clearInterval(e.autorefresh)}),1e3)},ab2str:function(e,t){var a=new Blob([e]),l=new FileReader;l.readAsText(a,"utf-8"),l.onload=function(){t&&t.call(null,l.result)}},exportData:function(e){var t=this;t.$message.closeAll(),this.$confirm("确定导出此数据？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["a"])({url:"/sys/export_unauthorize_license?id="+e.id,method:"post",responseType:"arraybuffer"}).then((function(e){var a=e.data;t.ab2str(a,(function(l){if(l.indexOf("status")>-1){var i=JSON.parse(l);t.$message({message:i.errormessage,type:"error",showClose:!0})}else{var s=e.headers["filename"],n=new Blob([a],{type:"application/octet-stream"});if("download"in document.createElement("a")){var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(n),r.setAttribute("download",s),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)}}}))}))})).catch((function(e){}))},delData:function(e){var t=this;t.$message.closeAll();var a=new FormData;a.append("id",e.id),this.$confirm("此操作将永久删除该数据，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["a"])({url:"/sys/delete_license",method:"post",data:a}).then((function(e){var a=e.data;0==a.status&&(t.$message({message:"操作成功!",type:"success",showClose:!0}),t.addSuccess())}))})).catch((function(e){}))},resetForm:function(){this.formInline.endDate="",this.formInline=Object.assign({},void 0),this.$refs.formInline.resetFields()}},destroyed:function(){clearInterval(this.autorefresh)}},F=w,C=(a("4e9c"),Object(m["a"])(F,l,i,!1,null,"06c497fb",null));t["default"]=C.exports},"4e9c":function(e,t,a){"use strict";a("d74c")},7875:function(e,t,a){"use strict";a("a747")},a747:function(e,t,a){},d74c:function(e,t,a){},f65e:function(e,t,a){"use strict";a("0f7b")}}]);
//# sourceMappingURL=chunk-618bbcb0.9ff55c17.js.map