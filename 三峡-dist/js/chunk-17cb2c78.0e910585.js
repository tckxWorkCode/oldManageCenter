(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17cb2c78"],{"2b8b":function(e,t,a){e.exports=a.p+"img/nodata1.3cbcbf06.png"},"339d":function(e,t,a){"use strict";a("e0c7")},8819:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"container"},[a("div",{staticClass:"topNav"},[a("el-breadcrumb",{staticClass:"breadNav",attrs:{separator:"/"}},[a("el-breadcrumb-item",{staticClass:"crumb1"},[e._v("首页")]),a("el-breadcrumb-item",{staticClass:"crumb1"},[e._v("可信验证")]),a("el-breadcrumb-item",{staticClass:"crumb2"},[e._v("启动度量")])],1)],1),a("div",{staticClass:"wrap"},[a("div",{staticClass:"search"},[a("el-form",{ref:"formInline",staticClass:"formInline",attrs:{inline:!0,"label-position":"right","label-width":"150px",model:e.formInline,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"终端名称/网络地址：",prop:"terminalName"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入终端名称/网络地址",oninput:"value=value.replace(/[%]/g, '')"},model:{value:e.formInline.terminalName,callback:function(t){e.$set(e.formInline,"terminalName",t)},expression:"formInline.terminalName"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.advancedSearch,expression:"advancedSearch==true"}],attrs:{label:"日期：",prop:"startDate"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",editable:!1,type:"date",placeholder:"选择开始时间"},model:{value:e.formInline.startDate,callback:function(t){e.$set(e.formInline,"startDate",t)},expression:"formInline.startDate"}}),e._v(" "),a("span",{},[e._v("至")]),e._v(" "),a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",editable:!1,type:"date",placeholder:"选择结束时间"},model:{value:e.formInline.endDate,callback:function(t){e.$set(e.formInline,"endDate",t)},expression:"formInline.endDate"}})],1),a("el-form-item",{staticClass:"advancedBtn"},[a("el-button",{staticClass:"resetBtn",attrs:{size:"small"},on:{click:e.resetForm}},[e._v("重置")]),a("el-button",{staticClass:"searchBtn",attrs:{size:"small"},on:{click:e.searchData}},[e._v("查询")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.advancedFlag,expression:"advancedFlag==true"}],staticClass:"gaoji",attrs:{size:"small"},on:{click:e.switchBtn}},[e._v("展开"),a("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{"font-weight":"bold"}})]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.advancedFlag,expression:"advancedFlag==false"}],staticClass:"gaoji",attrs:{size:"small"},on:{click:e.switchBtn}},[e._v("收起"),a("i",{staticClass:"el-icon-arrow-up el-icon--right",staticStyle:{"font-weight":"bold"}})])],1)],1)],1),a("div",{staticClass:"mainContainer"},[a("div",{staticClass:"tableTitle"},[e._v("启动度量")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"startMeasureTable",staticStyle:{width:"99%","font-size":"14px"},attrs:{data:e.startMeasureData,size:"mini","tooltip-effect":"light","element-loading-text":"加载中，请稍后","header-cell-style":{height:"48px","background-color":"#F0F2F5",color:"rgba(0, 0, 0, 0.72)",padding:"0px"},"cell-style":{color:"rgba(0, 0, 0, 0.9)",padding:"0px"},fit:!0,"row-key":"nodeId"},on:{"sort-change":e.sortChange}},[a("template",{slot:"empty"},[a("div",[e._v("暂无数据")])]),a("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号",width:"50px"}}),a("el-table-column",{attrs:{prop:"name",label:"终端名称","min-width":"100%","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"ip",label:"网络地址","min-width":"100%"}}),a("el-table-column",{attrs:{prop:"onlineStatus",label:"终端状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.onlineStatus?a("span",[a("span",{staticClass:"aqua"},[e._v("●")]),e._v("在线")]):"0"==t.row.onlineStatus?a("span",[a("span",{staticClass:"lightRed"},[e._v("●")]),e._v("离线")]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"bmeasureStatus",label:"启动策略状态","min-width":"100%",formatter:e.statusVal}}),a("el-table-column",{attrs:{prop:"beBootMeasureResult",label:"结果",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.beBootMeasureResult?a("span",[a("span",{staticClass:"aqua"},[e._v("●")]),e._v("可信")]):"1"==t.row.beBootMeasureResult?a("span",[a("span",{staticClass:"lightRed"},[e._v("●")]),e._v("不可信")]):"2"==t.row.beBootMeasureResult?a("span",[a("span",{staticClass:"greyDot"},[e._v("●")]),e._v("未度量")]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"installerTime",label:"时间","min-width":"100%",sortable:"custom","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"100%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"#1ac492"},attrs:{type:"text"},on:{click:function(a){return e.policyRecord(t.row)}}},[e._v("查看记录")])]}}])})],2),e.pageShow?a("el-pagination",{staticClass:"paging",attrs:{align:"right","current-page":e.currentPage.sync,"page-sizes":[10,20],"page-size":e.pageSize,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)])]),a("measure-record",{ref:"record"})],1)},i=[],n=(a("d81d"),a("ac1f"),a("5319"),a("b775")),l=a("ac95"),r=a("b893"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"启动度量记录",top:"5vh",width:"65%",visible:e.dialogFormVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.diaClose}},[s("div",{staticStyle:{display:"flex"}},[s("el-form",{ref:"ruleForm",staticStyle:{flex:"2"},attrs:{"label-position":"right","label-width":"90px",size:"small"}},[s("el-form-item",{attrs:{prop:"ip",label:"网络地址："}},[s("el-input",{staticStyle:{width:"45%"},attrs:{clearable:"",disabled:""},model:{value:e.ip,callback:function(t){e.ip=t},expression:"ip"}},[e._v(e._s(e.ip))])],1)],1),s("div",{staticClass:"statusTip"},[s("el-button",{attrs:{size:"small"},on:{click:e.getNewListRecord}},[e._v("获取新记录")])],1)],1),s("el-table",{staticStyle:{width:"100%",border:"1px solid #F0F2F5"},attrs:{data:e.tableData.slice((e.currentPage2-1)*e.pageSize2,e.currentPage2*e.pageSize2),stripe:"","tooltip-effect":"light","header-cell-style":{height:"48px","background-color":"#F0F2F5",color:"rgba(0, 0, 0, 0.72)",padding:"0px"},"max-height":"55vh"}},[s("template",{slot:"empty"},[e.emptytxt?s("img",{attrs:{src:a("2b8b")}}):e._e()]),s("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号",width:"50px"}}),s("el-table-column",{attrs:{prop:"stage",label:"度量阶段","min-width":"110%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.stage>=0&&t.row.stage<=999?s("span",[e._v("TPCM及度量加载器(BIOS,UBOOT)及前期固件验证")]):t.row.stage>=1e3&&t.row.stage<=1999?s("span",[e._v("加载器加载驱动、配置、操作系统或二级加载器(GRUB)")]):t.row.stage>=2e3&&t.row.stage<=2999?s("span",[e._v("二级加载器(GRUB)加载驱动、配置、操作系统")]):t.row.stage>=3e3?s("span",[e._v("操作系统加载驱动、配置、服务程序")]):s("span",[e._v(e._s(t.row.stage))])]}}])}),s("el-table-column",{attrs:{prop:"name",label:"度量对象名称","min-width":"150%"}}),s("el-table-column",{attrs:{prop:"bootMeasures",label:"度量对象hash","min-width":"200%"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.bootMeasures,(function(t,a){return s("div",{key:a},[s("div",{staticStyle:{"margin-bottom":"5px"}},[e._v(e._s(t.hash))])])}))}}])}),s("el-table-column",{attrs:{prop:"result",label:"度量结果","min-width":"100%"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.result?s("span",[e._v("可信")]):"1"==t.row.result?s("span",[e._v("不可信")]):"2"==t.row.result?s("span",[e._v("未度量")]):e._e()]}}])}),s("el-table-column",{attrs:{prop:"time",label:"度量时间","min-width":"115%"}})],2),s("el-pagination",{staticClass:"paging",attrs:{align:"right","current-page":e.currentPage2,"page-sizes":[10,20],"page-size":e.pageSize2,layout:"total, prev, pager, next, jumper",total:e.total2},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}})],1)},c=[],d={name:"ConfigPop",data:function(){return{dialogFormVisible:!1,emptytxt:"",onlineStatus:"",tableData:[],currentPage2:1,total2:0,pageSize2:10,nodeId:"",getOldBtn:!1,autorefresh:"",timer:"",recordType:"",ip:"",num:0}},methods:{diaOpen:function(e){var t=this;t.ip=e.ip,t.emptytxt="",t.dialogFormVisible=!0,t.tableData=[],t.recordType="",t.nodeId=e.nodeId,this.onlineStatus=e.onlineStatus,t.getOldBtn=!1,this.num=0,this.getOldList()},diaClose:function(){var e=this;e.dialogFormVisible=!1},indexMethod:function(e){return 1===this.currentPage2?e<9?"0"+(e+1):e+1:e+1+this.pageSize2*(this.currentPage2-1)},handleSizeChange2:function(e){var t=this;this.pageSize2=e,"list"==t.recordType?t.getNewList():"old"==t.recordType&&t.getOldList()},handleCurrentChange2:function(e){var t=this;this.currentPage2=e,"list"==t.recordType?t.getNewList():"old"==t.recordType&&t.getOldList()},getNewListRecord:function(){var e=this;if(0==this.onlineStatus)return e.$message({showClose:!0,message:"终端已离线",type:"error"});Object(n["a"])({url:"/sec/lBMeasureRecord",method:"post",data:{node_id:e.nodeId}}).then((function(t){t.data;e.initData()})),"[]"==JSON.stringify(e.tableData)?e.timer=setInterval((function(){"[]"!=JSON.stringify(e.tableData)&&void 0!=JSON.stringify(e.tableData)&&e.tableData.length>0&&e.$message({showClose:!0,message:"已获取最新记录",type:"success"})}),2e3):(clearInterval(e.autorefresh),clearInterval(e.timer),e.$message({showClose:!0,message:"已获取最新记录",type:"success"})),setTimeout((function(){clearInterval(e.autorefresh),clearInterval(e.timer),"[]"==JSON.stringify(e.tableData)||void 0==JSON.stringify(e.tableData)?(e.getOldList(),e.$message({showClose:!0,message:"请求已超时，已获取历史记录",type:"warning"})):e.$message({showClose:!0,message:"已获取最新记录",type:"success"})}),5e3)},initData:function(){var e=this;e.autorefresh=setInterval((function(){e.getNewList()}),1e3)},getNewList:function(){var e=this;this.num++,Object(n["a"])({url:"/sec/lBMeasureRecordTree?nodeId="+e.nodeId,method:"post"}).then((function(t){var a=t.data;0==a.total?e.emptytxt=!0:e.emptytxt=!1,a.data&&(a.data.map((function(e,t){e.time=Object(l["a"])(e.time)})),e.tableData=a.data,e.total2=a.data.length,e.recordType="list")}))},getOldList:function(){var e=this;Object(n["a"])({url:"/sec/lBMeasureRecordTreeOld?nodeId="+e.nodeId,method:"post"}).then((function(t){var a=t.data;a.data&&(a.data.map((function(e,t){e.time=Object(l["a"])(e.time)})),e.tableData=a.data,e.total2=a.data.length,e.recordType="old"),0==a.total?e.emptytxt=!0:e.emptytxt=!1}))}},destroyed:function(){clearInterval(this.autorefresh),clearInterval(this.timer)}},u=d,p=(a("339d"),a("2877")),h=Object(p["a"])(u,o,c,!1,null,"59a0b59b",null),m=h.exports,g={name:"StartMetrics",components:{MeasureRecord:m},data:function(){return{loading:!1,formInline:{terminalName:"",startDate:"",endDate:""},advancedSearch:!0,advancedFlag:!1,emptytxt:"",startMeasureData:[],orderBy:"installer_time desc",currentPage:1,total:0,pageSize:10,pageShow:!0,autorefresh:"",showDialog:!1,mask:!1,rowMessage:{}}},created:function(){Object(r["b"])(this.searchData)},mounted:function(){this.loadData()},beforeDestroy:function(){document.onkeydown=null},methods:{loadData:function(){var e=this;this.loading=!0,Object(n["a"])({url:"/sec/lBMeasureListAll",method:"post",data:{condition:this.formInline.terminalName,firstTime:this.formInline.startDate,lastTime:this.formInline.endDate,system_type:"1",orderBy:this.orderBy,searchPage:this.currentPage,searchSize:this.pageSize}}).then((function(t){var a=t.data;e.loading=!1,a.list&&(a.list.map((function(e,t){e.installerTime=Object(l["a"])(e.installerTime)})),e.startMeasureData=a.list,e.total=a.total),0==a.total?e.emptytxt=!0:e.emptytxt=!1}))},statusVal:function(e){var t=this.$createElement,a="";if(null==e.lpolicyStatus)a="";else if(0==e.lpolicyStatus.bmeasureStatus)a=t("span",{class:"wathet"},["已下发"]);else if(1==e.lpolicyStatus.bmeasureStatus)a=t("span",{class:"green"},["下发配置成功"]);else if(2==e.lpolicyStatus.bmeasureStatus){var s=Object(r["a"])(e.lpolicyStatus.bmeasureRes);a=s?t("span",{class:"red"},["下发失败（",s,"）"]):e.lpolicyStatus.bmeasureRes?t("span",{class:"red"},["下发失败（错误码：",e.lpolicyStatus.bmeasureRes,"）"]):t("span",{class:"red"},["下发失败"])}else a=t("span",{class:"grey"},["初始化状态"]);return a},switchBtn:function(){this.advancedSearch=!this.advancedSearch,this.advancedFlag=!this.advancedFlag},searchData:function(){var e=this;this.currentPage=1,this.loadData(),this.pageShow=!1,this.$nextTick((function(){e.pageShow=!0}))},indexMethod:function(e){return 1===this.currentPage?e<9?"0"+(e+1):e+1:e+1+this.pageSize*(this.currentPage-1)},sortChange:function(e,t,a){a=e.prop.replace(/([A-Z])/g,"_$1").toLowerCase();"ascending"==e.order?this.orderBy=a:this.orderBy=a+" desc",this.loadData()},handleSizeChange:function(e){var t=this;this.currentPage=1,this.pageSize=e,this.pageShow=!1,this.$nextTick((function(){t.pageShow=!0})),this.loadData()},handleCurrentChange:function(e){this.currentPage=e,this.loadData()},openDialog:function(e){this.showDialog=!0,this.rowMessage=JSON.parse(JSON.stringify(e)),this.mask=!0},closeDialog:function(){this.showDialog=!1,this.mask=!1},resetForm:function(){this.formInline.endDate="",this.formInline=Object.assign({},void 0),this.$refs.formInline.resetFields()},openConfig:function(e){0==e.onlineStatus?this.$message({message:"终端已离线",type:"error",showClose:!0}):this.$refs.poplay.diaOpen(e)},policyRecord:function(e){this.$refs.record.diaOpen(e)},refreshData:function(){var e=this,t=0;e.autorefresh=setInterval((function(){t++,e.loadData(),t>5&&clearInterval(e.autorefresh)}),3e3)}},destroyed:function(){clearInterval(this.autorefresh)}},f=g,b=(a("a8d4"),Object(p["a"])(f,s,i,!1,null,"5d98154e",null));t["default"]=b.exports},a8d4:function(e,t,a){"use strict";a("ab36")},ab36:function(e,t,a){},e0c7:function(e,t,a){}}]);
//# sourceMappingURL=chunk-17cb2c78.0e910585.js.map